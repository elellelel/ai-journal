<div class="row">
  <div class="col-sm-9">
    <%= link_to 'New Entry', new_entry_path, class: "btn btn-primary" %>
  </div>
</div>

<div class="row">
  <div class="col-sm-3">
    <table class="table table-striped table-hover">
      <tbody>
        <% @entries.each do |entry| %>
          <tr>
            <td><%= link_to entry.title, entry, class: "text-decoration-none" %></td>
            <td>
              <%= link_to 'Edit', edit_entry_path(entry), class: "btn btn-sm btn-warning" %>
              <%= link_to 'Delete', entry_path(entry), 
                        class: "btn btn-sm btn-danger", 
                        data: { "turbo-method": :delete, confirm: 'Are you sure?' } %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="col-sm-9">
    <div class="chat-container">
      <div id="chat-box" class="border p-3 mb-3" style="height: 400px; overflow-y: scroll;">
        <!-- Chat messages will be dynamically appended here -->
      </div>

      <form id="chat-form" class="d-flex">
        <input
          type="text"
          id="chat-input"
          class="form-control me-2"
          placeholder="Type your message here..."
          autocomplete="off"
        />
        <button type="submit" class="btn btn-primary">Send</button>
      </form>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const chatForm = document.getElementById("chat-form");
    const chatInput = document.getElementById("chat-input");
    const chatBox = document.getElementById("chat-box");

    chatForm.addEventListener("submit", (event) => {
      event.preventDefault();

      const userMessage = chatInput.value;
      if (!userMessage) return;

      // Display user's message
      const userMessageDiv = document.createElement("div");
      userMessageDiv.className = "user-message mb-2";
      userMessageDiv.textContent = `You: ${userMessage}`;
      chatBox.appendChild(userMessageDiv);

      // Clear the input
      chatInput.value = "";

      // Send the message to the server
      fetch("/chats", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRF-Token": document.querySelector("[name='csrf-token']").content,
        },
        body: JSON.stringify({ message: userMessage }),
      })
        .then((response) => response.json())
        .then((data) => {
          // Display AI response
          const aiMessageDiv = document.createElement("div");
          aiMessageDiv.className = "ai-message mb-2";
          aiMessageDiv.innerHTML = `AI: ${data.message}`;
          chatBox.appendChild(aiMessageDiv);

          // Scroll to the bottom
          chatBox.scrollTop = chatBox.scrollHeight;
        })
        .catch((error) => console.error("Error:", error));
    });
  });
</script>